# 实现计划

- [x] 1. uv项目环境初始化和配置





  - 使用uv创建Python 3.12项目和虚拟环境
  - 配置pyproject.toml文件定义项目依赖和元数据
  - 创建项目目录结构和基础文件
  - 设置开发工具配置(black, ruff, pytest)
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 2. 核心数据模型和接口定义
  - 定义核心数据模型和枚举类型(ModelInfo, ModelType, InferenceResult等)
  - 实现基础推理器抽象接口
  - 创建配置管理和参数验证类
  - 实现自定义异常类
  - _需求: 2.1, 3.5, 3.6_

- [x] 3. 模型发现和类型识别功能




  - [x] 3.1 实现模型文件扫描器


    - 编写文件系统扫描逻辑，支持递归目录搜索
    - 实现文件扩展名识别(.bin, .pt, .pth, .safetensors, .gguf)
    - 添加文件大小、路径信息收集和模型元数据解析
    - 创建模型文件扫描的单元测试
    - _需求: 2.1, 2.2, 2.3_

  - [x] 3.2 创建模型管理器


    - 实现ModelManager类的核心功能
    - 添加模型列表缓存和更新机制
    - 实现模型选择验证(最多4个模型限制)
    - 创建模型管理器的单元测试
    - _需求: 2.5, 3.1, 3.2_

- [x] 4. 配置管理和参数验证




  - [x] 4.1 实现配置管理器

    - 创建ModelConfig数据类和默认参数(包含PyTorch和GGUF特定参数)
    - 实现参数验证逻辑(范围检查、类型验证)
    - 添加配置的JSON持久化存储功能
    - 创建配置管理的单元测试
    - _需求: 3.3, 3.4, 3.5, 3.6_

  - [x] 4.2 创建参数验证器



    - 实现不同模型类型的参数验证规则
    - 添加实时参数验证和错误提示功能
    - 实现参数范围和兼容性检查
    - 创建参数验证器的单元测试
    - _需求: 3.4, 3.5_

- [x] 5. PyTorch推理器实现





  - [x] 5.1 实现PyTorch模型加载器


    - 使用transformers库实现模型和tokenizer加载
    - 添加GPU/CPU/MPS设备自动检测和配置
    - 支持.safetensors格式和内存优化加载
    - 实现模型加载错误处理和资源清理
    - 创建PyTorch加载器的单元测试
    - _需求: 4.2, 4.5_

  - [x] 5.2 实现PyTorch流式推理


    - 使用TextIteratorStreamer实现流式文本生成
    - 添加生成参数配置(temperature, top_p, max_tokens等)
    - 实现推理统计信息收集(时间、token数量、速度)
    - 添加生成中断和错误恢复机制
    - 创建PyTorch推理的单元测试
    - _需求: 5.2, 5.4, 7.3_

- [x] 6. GGUF推理器实现





  - [x] 6.1 实现GGUF模型加载器


    - 使用llama-cpp-python库实现GGUF模型加载
    - 配置上下文长度、线程数和硬件加速选项(CUDA/OpenCL/Metal)
    - 添加GGUF特定的错误处理和内存管理逻辑
    - 创建GGUF加载器的单元测试
    - _需求: 4.3, 4.5_

  - [x] 6.2 实现GGUF流式推理


    - 使用llama-cpp-python的流式生成功能
    - 配置GGUF特定参数(top_k, repeat_penalty, n_ctx等)
    - 实现token级别的流式输出和统计收集
    - 添加推理过程监控和错误处理
    - 创建GGUF推理的单元测试
    - _需求: 5.2, 5.4, 7.3_

- [ ] 7. 内存管理和资源优化
  - [x] 7.1 实现内存管理器


    - 创建模型加载和卸载的队列管理系统
    - 实现内存使用监控和清理机制(使用psutil)
    - 添加强制垃圾回收和GPU内存释放逻辑
    - 实现内存使用统计和报告功能
    - 创建内存管理器的单元测试
    - _需求: 4.1, 4.4, 4.5, 4.6_

  - [x] 7.2 实现推理引擎协调器









    - 创建InferenceEngine类协调多模型推理
    - 实现顺序模型处理和结果聚合
    - 添加推理过程的错误恢复和重试机制
    - 实现推理任务的取消和清理功能
    - 创建推理引擎的单元测试
    - _需求: 4.1, 4.4, 5.5_

- [x] 8. Streamlit用户界面开发




  - [x] 8.1 完善主界面布局和交互功能


    - 集成模型管理器到main.py中实现模型发现和选择
    - 添加提示词输入(st.text_area)和比较触发按钮
    - 实现模型配置参数的动态更新和保存
    - 添加比较进度显示和状态反馈
    - 创建UI组件的单元测试
    - _需求: 7.1, 7.2, 7.5_

  - [x] 8.2 实现模型输出显示区域



    - 使用st.columns()创建并排输出区域
    - 实现流式内容的实时更新显示(st.empty())
    - 添加模型标识、状态指示器和进度条
    - 实现输出区域的动态调整和响应式布局
    - 创建输出显示的单元测试
    - _需求: 7.2, 7.6, 5.1, 5.2_

- [-] 9. Markdown渲染和格式化


  - [x] 9.1 实现Markdown内容渲染


    - 集成Streamlit的st.markdown()组件进行内容渲染
    - 添加代码块的语法高亮显示和复制功能
    - 实现表格和列表的格式化显示
    - 添加数学公式和特殊字符的渲染支持
    - 创建Markdown渲染的单元测试
    - _需求: 6.1, 6.2, 6.3_

  - [x] 9.2 添加原始文本查看功能



    - 实现渲染视图和原始文本的切换功能
    - 添加长内容的滚动查看和折叠展开支持
    - 创建内容格式化的用户控制选项
    - 实现内容搜索和高亮功能
    - 创建文本查看功能的单元测试
    - _需求: 6.4, 6.5_

- [x] 10. 结果导出和数据管理




  - [x] 10.1 实现结果导出功能


    - 创建JSON格式的比较结果导出
    - 实现CSV格式的统计数据导出
    - 添加Markdown和TXT格式的报告生成
    - 实现导出文件的下载功能(st.download_button)
    - 创建结果导出的单元测试
    - _需求: 7.4_

  - [x] 10.2 添加会话管理功能


    - 实现比较历史的本地存储和管理
    - 添加清除当前结果和重新开始功能
    - 创建会话恢复和结果回放功能
    - 实现会话数据的备份和恢复
    - 创建会话管理的单元测试
    - _需求: 7.5_

- [-] 11. 错误处理和用户体验优化



  - [x] 11.1 实现全面的错误处理


    - 添加模型加载失败的友好错误提示和解决建议
    - 实现推理过程异常的优雅处理和错误恢复
    - 创建文件访问错误的恢复机制
    - 实现错误日志记录和调试信息收集
    - 创建错误处理的单元测试
    - _需求: 5.5, 2.4_

  - [x] 11.2 优化用户界面体验















    - 添加加载进度指示器和状态反馈(st.progress, st.spinner)
    - 实现操作确认和撤销功能
    - 优化界面响应性和交互流畅度
    - 添加键盘快捷键和无障碍功能支持
    - 创建用户体验的集成测试
    - _需求: 5.3, 7.6_

- [ ] 12. 测试套件开发
  - [ ] 12.1 创建单元测试套件
    - 使用pytest编写模型发现和类型识别的测试用例
    - 实现参数验证和配置管理的测试
    - 创建推理器功能的模拟测试和边界条件测试
    - 添加内存管理和资源清理的测试
    - 配置测试覆盖率报告和CI集成
    - _需求: 所有需求的单元验证_

  - [ ] 12.2 实现集成测试和性能测试
    - 创建端到端的模型比较流程测试
    - 实现内存管理和资源清理的验证测试
    - 添加Streamlit界面的自动化测试
    - 创建性能基准测试和内存泄漏检测
    - 实现多平台兼容性测试
    - _需求: 所有需求的集成验证_

- [ ] 13. 部署和文档
  - [ ] 13.1 创建uv部署配置
    - 确保uv.lock文件包含所有依赖的精确版本
    - 创建启动脚本使用uv run运行应用
    - 添加Docker容器化配置(基于uv环境)
    - 创建环境变量配置和部署说明
    - 实现健康检查和监控端点
    - _需求: 1.4, 1.5_

  - [x] 13.2 编写用户文档和开发指南





    - 创建README文件和快速开始指南(包含uv安装说明)
    - 编写模型配置和使用说明文档
    - 添加常见问题和故障排除指南
    - 创建开发者贡献指南和代码规范
    - 编写API文档和架构说明
    - _需求: 1.5, 用户使用支持_